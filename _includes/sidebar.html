<a href='{{ site.content.ribbon_link | default: "/contributing.html" }}' class='ribbon'>{{ site.content.ribbon_text | default: "Add your paper" }}</a>

<!-- ================= Right Sidebar ================= -->
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          {% if site.logo and site.logo != '' %}
            <img src="{{ site.logo }}" alt="{{ site.title }}" style="max-height: 60px;">
          {% else %}
            {{ site.title }}
          {% endif %}
        </a>
      </h1>
      <p class="lead">{{ site.description }}</p>      
    </div>

    <nav class="sidebar-nav">
      {% if site.features.search_enabled != false %}
      <div class="sidebar-item">
        <p style="font-size: 12px">
          {{ site.content.search_placeholder | default: 'Search related work' }}
          <input type='text' id='searchTarget' size="16"/> 
          <button onClick="search();">Go</button>
        </p>
      </div>
      {% endif %}

      <a class="sidebar-nav-item{% if page.url == '/papers.html' %} active{% endif %}" href="/papers.html">{{ site.content.nav.all_papers | default: 'All Papers' }}</a>
      <a class="sidebar-nav-item{% if page.url == "/tags.html" %} active{% endif %}" href="{% link tags.html %}">{{ site.content.nav.papers_by_tag | default: 'Papers by Tag' }}</a>
      {% if site.features.viz_enabled != false %}
      <a class="sidebar-nav-item{% if page.url == "/tsne-viz.html" %} active{% endif %}" href="{% link tsne-viz.html %}">{{ site.content.nav.paper_map | default: '2D Map of Papers' }}</a>
      <a class="sidebar-nav-item{% if page.url == "/topic-viz.html" %} active{% endif %}" href="{% link topic-viz.html %}">{{ site.content.nav.topic_explorer | default: 'Topic Explorer' }}</a>
      {% endif %}
      <a class="sidebar-nav-item{% if page.url == "/opensource.html" %} active{% endif %}" href="{% link opensource.markdown %}">{{ site.content.nav.tools_explorer | default: 'Tools Explorer' }}</a>
      <a class="sidebar-nav-item{% if page.url == "/blogs.html" %} active{% endif %}" href="{% link blogs.markdown %}">{{ site.content.nav.blog_explorer | default: 'Blog & Book Explorer' }}</a>
      {% if site.features.viz_enabled != false %}
      <a class="sidebar-nav-item{% if page.url == "/author-viz.html" %} active{% endif %}" href="{% link author-viz.html %}">{{ site.content.nav.author_explorer | default: 'Author Explorer' }}</a>
      {% endif %}
      {% if site.features.chat_enabled != false %}
      <a class="sidebar-nav-item{% if page.url == "/chatbot.html" %} active{% endif %}" href="{% link chatbot.markdown %}">{{ site.content.nav.agentic_search | default: 'Agentic Search' }}</a>
      {% endif %}
    </nav>

    <!-- ===== Stay Updated (minimal block) ===== -->
    {% if site.features.digest_enabled != false or site.features.rss_enabled != false %}
    <hr style="border:none; border-top:1px solid #d8dee9; margin:0.75rem 0;" />
    <div class="sidebar-item" aria-label="Stay updated">
      <h3 style="margin:0 0 0.25rem 0; font-size:1rem;">Stay Updated</h3>
      <ul style="list-style:none; padding-left:0; margin:0;">
        {% if site.features.digest_enabled != false %}
        <li style="margin:0.35rem 0;">
          <a class="sidebar-nav-item" href="/digest.html">{{ site.content.nav.digest | default: 'ðŸ“¬ Subscribe to E-Mail Digest' }}</a>
        </li>
        {% endif %}
        {% if site.features.rss_enabled != false %}
        <li style="margin:0.35rem 0;">
          <a class="sidebar-nav-item" href="/feed/publications.xml" rel="alternate" type="application/rss+xml">{{ site.content.nav.rss_feed | default: 'ðŸ“° RSS Feed' }}</a>
        </li>
        {% endif %}
       </ul>
    </div>
    {% endif %}
    <!-- ===== End Stay Updated ===== -->

    <div class="sidebar-item">
      <p style="font-size: 12px">
        {{ site.content.footer.contact_text | default: 'Contact us about this survey or website.' }}
        <span style="font-size: 9px">
          Made with <a href="https://jekyllrb.com">Jekyll</a> and 
          <a href="https://github.com/poole/hyde">Hyde</a>.
        </span>
      </p>
    </div>
  </div>
</div>

<!-- ================= Styles ================= -->
<style>
/* Theme variables from config */
:root {
  --sidebar-bg: {{ site.theme.sidebar_bg | default: '#7da2b3' }};
  --brand-color: {{ site.theme.brand_color | default: '#1a73e8' }};
}

/* === Wider Right Sidebar === */
.sidebar {
  position: fixed;
  top: 0;
  right: 0;
  height: 100vh;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 1.5rem 1.25rem;
  box-sizing: border-box;
  background-color: var(--sidebar-bg);
  scrollbar-gutter: stable;

  /* wider: 260â€“420px instead of 240â€“340px */
  width: clamp(260px, 30vw, 420px);
  max-width: clamp(260px, 30vw, 420px);
}

/* Keep sticky container natural flow */
.sidebar .container.sidebar-sticky {
  position: relative;
  max-height: none;
  overflow: visible;
}

/* Prettier scrollbars */
.sidebar::-webkit-scrollbar { width: 8px; }
.sidebar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.25); border-radius: 4px; }
.sidebar::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.4); }

/* main content offset equals sidebar width */
.main,
.content {
  margin-right: clamp(260px, 30vw, 420px);
}

/* Mobile collapse */
@media (max-width: 880px) {
  .sidebar {
    position: static;
    height: auto;
    width: auto;
    max-width: none;
    border-bottom: 1px solid rgba(0,0,0,0.08);
  }
  .main,
  .content {
    margin-right: 0 !important;
  }
}
</style>

<!-- ================= Script ================= -->
<script defer>
document.addEventListener('DOMContentLoaded', function () {
  // ---- Search ----
  function doSearch() {
    const el = document.getElementById('searchTarget');
    if (!el) return;
    const q = el.value.trim();
    try { if (typeof ga === 'function') ga('send', 'event', 'search', 'search', q); } catch(e) {}
    window.location = "{{ '/papers.html' | relative_url }}#" + encodeURIComponent(q);
  }

  if (window.jQuery) {
    $('#searchTarget').on('keydown', function (e) {
      if (e.key === 'Enter') doSearch();
    });
    document.querySelector('.sidebar-item button')?.addEventListener('click', doSearch);
  } else {
    const input = document.getElementById('searchTarget');
    const btn = document.querySelector('.sidebar-item button');
    if (input) {
      input.addEventListener('keydown', function (e) {
        if (e.key === 'Enter') doSearch();
      });
    }
    if (btn) btn.addEventListener('click', doSearch);
  }

  window.search = doSearch;

  // ---- Match content margin to actual sidebar width ----
  const sb = document.querySelector('.sidebar');
  const mains = document.querySelectorAll('.main, .content');
  function syncSidebarWidth() {
    if (!sb) return;
    const w = sb.offsetWidth + 'px';
    mains.forEach(m => m && (m.style.marginRight = w));
  }
  syncSidebarWidth();
  window.addEventListener('resize', syncSidebarWidth);
});
</script>
